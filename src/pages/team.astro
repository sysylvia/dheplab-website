---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Active team members
const team = await getCollection('team', ({ data }) => data.active);
const sortedTeam = team.sort((a, b) => a.data.order - b.data.order);

// Alumni (inactive members)
const alumniCollection = await getCollection('team', ({ data }) => !data.active);
const sortedAlumni = alumniCollection.sort((a, b) => a.data.order - b.data.order);

// Group active members by role type
const leadership = sortedTeam.filter(m => ['Director', 'Co-Director'].includes(m.data.role));
const researchers = sortedTeam.filter(m => ['Postdoc', 'Research Associate', 'Research Scientist'].includes(m.data.role));
const students = sortedTeam.filter(m => ['PhD Student', 'Doctoral Student', 'Masters Student'].includes(m.data.role));
const staff = sortedTeam.filter(m => ['Staff', 'Project Manager', 'Research Coordinator', 'Lab Manager', 'Research Assistant', 'Developer'].includes(m.data.role));
const collaborators = sortedTeam.filter(m => ['Collaborator'].includes(m.data.role));
---

<BaseLayout title="Team" description="Meet the researchers, students, and staff of DHEPLab.">

  <!-- Hero -->
  <section class="relative py-20 bg-cover bg-center" style="background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.88) 0%, rgba(245, 244, 240, 0.85) 100%), url('/images/heroes/team-hero.jpg');">
    <div class="container">
      <p class="eyebrow text-carolina mb-4">Our People</p>
      <h1 class="text-4xl md:text-5xl font-display text-navy mb-6">Team</h1>
      <p class="text-xl text-charcoal max-w-2xl">
        A collaborative group of economists, data scientists, and policy researchers
        working to advance digital health through rigorous research.
      </p>
    </div>
  </section>

  <!-- Team Members -->
  <section class="py-16 bg-paper">
    <div class="container">

      <!-- Leadership -->
      {leadership.length > 0 && (
        <div class="mb-16">
          <h2 class="text-2xl font-display text-navy mb-8">Leadership</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {leadership.map((member) => (
              <a href={`/team/${member.id}`} class="card text-center group cursor-pointer">
                {member.data.image ? (
                  <img src={member.data.image} alt={member.data.name} class="w-32 h-32 mx-auto rounded-full object-cover mb-4 group-hover:ring-4 group-hover:ring-carolina/30 transition-all" />
                ) : (
                  <div class="w-32 h-32 mx-auto rounded-full bg-stone flex items-center justify-center text-navy text-3xl font-semibold mb-4 group-hover:ring-4 group-hover:ring-carolina/30 transition-all">
                    {member.data.name.split(' ').map(n => n[0]).join('')}
                  </div>
                )}
                <h3 class="text-xl font-semibold text-navy group-hover:text-carolina transition-colors">{member.data.name}</h3>
                <p class="text-carolina font-medium">{member.data.role}</p>
                {member.data.title && (
                  <p class="text-sm text-slate mt-1">{member.data.title}</p>
                )}
                <p class="text-sm text-slate mt-4 leading-relaxed">
                  {member.data.bio.slice(0, 200)}...
                </p>
                <div class="mt-4 text-carolina text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity">
                  View Profile â†’
                </div>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Researchers -->
      {researchers.length > 0 && (
        <div class="mb-16">
          <h2 class="text-2xl font-display text-navy mb-8">Research Team</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {researchers.map((member) => (
              <a href={`/team/${member.id}`} class="card text-center group cursor-pointer">
                {member.data.image ? (
                  <img src={member.data.image} alt={member.data.name} class="w-20 h-20 mx-auto rounded-full object-cover mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all" />
                ) : (
                  <div class="w-20 h-20 mx-auto rounded-full bg-stone flex items-center justify-center text-navy text-xl font-semibold mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all">
                    {member.data.name.split(' ').map(n => n[0]).join('')}
                  </div>
                )}
                <h3 class="font-semibold text-navy group-hover:text-carolina transition-colors">{member.data.name}</h3>
                <p class="text-sm text-carolina">{member.data.role}</p>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Students -->
      {students.length > 0 && (
        <div class="mb-16">
          <h2 class="text-2xl font-display text-navy mb-8">Students</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {students.map((member) => (
              <a href={`/team/${member.id}`} class="card text-center group cursor-pointer">
                {member.data.image ? (
                  <img src={member.data.image} alt={member.data.name} class="w-20 h-20 mx-auto rounded-full object-cover mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all" />
                ) : (
                  <div class="w-20 h-20 mx-auto rounded-full bg-stone flex items-center justify-center text-navy text-xl font-semibold mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all">
                    {member.data.name.split(' ').map(n => n[0]).join('')}
                  </div>
                )}
                <h3 class="font-semibold text-navy group-hover:text-carolina transition-colors">{member.data.name}</h3>
                <p class="text-sm text-carolina">{member.data.role}</p>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Staff -->
      {staff.length > 0 && (
        <div class="mb-16">
          <h2 class="text-2xl font-display text-navy mb-8">Staff</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {staff.map((member) => (
              <a href={`/team/${member.id}`} class="card text-center group cursor-pointer">
                {member.data.image ? (
                  <img src={member.data.image} alt={member.data.name} class="w-20 h-20 mx-auto rounded-full object-cover mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all" />
                ) : (
                  <div class="w-20 h-20 mx-auto rounded-full bg-stone flex items-center justify-center text-navy text-xl font-semibold mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all">
                    {member.data.name.split(' ').map(n => n[0]).join('')}
                  </div>
                )}
                <h3 class="font-semibold text-navy group-hover:text-carolina transition-colors">{member.data.name}</h3>
                <p class="text-sm text-carolina">{member.data.role}</p>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Collaborators -->
      {collaborators.length > 0 && (
        <div class="mb-16">
          <h2 class="text-2xl font-display text-navy mb-8">Collaborators</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {collaborators.map((member) => (
              <a href={`/team/${member.id}`} class="card text-center group cursor-pointer">
                {member.data.image ? (
                  <img src={member.data.image} alt={member.data.name} class="w-20 h-20 mx-auto rounded-full object-cover mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all" />
                ) : (
                  <div class="w-20 h-20 mx-auto rounded-full bg-stone flex items-center justify-center text-navy text-xl font-semibold mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all">
                    {member.data.name.split(' ').map(n => n[0]).join('')}
                  </div>
                )}
                <h3 class="font-semibold text-navy group-hover:text-carolina transition-colors">{member.data.name}</h3>
                <p class="text-sm text-carolina">{member.data.role}</p>
                {member.data.title && (
                  <p class="text-xs text-slate mt-1">{member.data.title}</p>
                )}
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Alumni -->
      {sortedAlumni.length > 0 && (
        <div>
          <h2 class="text-2xl font-display text-navy mb-8">Alumni</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {sortedAlumni.map((member) => (
              <a href={`/team/${member.id}`} class="card text-center bg-stone/30 group cursor-pointer">
                {member.data.image ? (
                  <img src={member.data.image} alt={member.data.name} class="w-16 h-16 mx-auto rounded-full object-cover mb-3 opacity-80 group-hover:opacity-100 group-hover:ring-4 group-hover:ring-carolina/30 transition-all" />
                ) : (
                  <div class="w-16 h-16 mx-auto rounded-full bg-stone flex items-center justify-center text-slate text-lg font-semibold mb-3 group-hover:ring-4 group-hover:ring-carolina/30 transition-all">
                    {member.data.name.split(' ').map(n => n[0]).join('')}
                  </div>
                )}
                <h3 class="font-semibold text-navy group-hover:text-carolina transition-colors">{member.data.name}</h3>
                {member.data.title && (
                  <p class="text-xs text-slate mt-1">{member.data.title}</p>
                )}
              </a>
            ))}
          </div>
        </div>
      )}

    </div>
  </section>

  <!-- Join Us CTA -->
  <section class="py-16 bg-carolina-pale">
    <div class="container text-center">
      <h2 class="text-2xl font-display text-navy mb-4">Join Our Team</h2>
      <p class="text-slate mb-6 max-w-xl mx-auto">
        We're always looking for talented researchers, students, and collaborators
        to join our work on digital health economics and policy.
      </p>
      <div class="flex justify-center gap-4">
        <a href="/contact" class="btn-primary">Contact Us</a>
        <a href="/opportunities" class="btn-secondary">View Opportunities</a>
      </div>
    </div>
  </section>

</BaseLayout>
