---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get news from collection (sorted by date, most recent first)
const allNews = await getCollection('news');
const sortedNews = allNews.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const featuredNews = sortedNews.filter(n => n.data.featured).slice(0, 1);
const otherNews = sortedNews.filter(n => !featuredNews.includes(n)).slice(0, 2);
const newsItems = [...featuredNews, ...otherNews];

// Get team from collection
const allTeam = await getCollection('team', ({ data }) => data.active);
const sortedTeam = allTeam.sort((a, b) => a.data.order - b.data.order).slice(0, 4);

// Research areas data
const researchAreas = [
  {
    title: "Clinical Decision Support",
    description: "Developing AI-assisted tools that complement human expertise in clinical settings, with rigorous evaluation of real-world impact.",
    icon: "/images/research/clinical-ai-icon.jpg",
    link: "/research/clinical-decision-support"
  },
  {
    title: "Patient Demand & Alignment",
    description: "Understanding patient behavior, preferences, and economic factors that drive healthcare utilization and outcomes.",
    icon: "/images/research/value-based-care-icon.jpg",
    link: "/research/patient-demand-alignment"
  },
  {
    title: "Digital Health Transformation",
    description: "Examining telemedicine, health information systems, collective intelligence, and the digitization of healthcare delivery.",
    icon: "/images/research/digital-health-policy-icon.jpg",
    link: "/research/digital-health-transformation"
  }
];

// Stats data
const stats = [
  { number: "$4.2M", label: "Active Grants" },
  { number: "47", label: "Publications" },
  { number: "12", label: "Team Members" },
  { number: "8", label: "Partner Organizations" }
];

// Helper function to format date
const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
};
---

<BaseLayout title="DHEPLab" description="Digital Health Economics & Policy Lab at UNC Gillings School of Global Public Health. Advancing health through rigorous research at the intersection of economics, policy, and digital innovation.">

  <!-- Hero Section -->
  <section class="relative py-16 md:py-24 min-h-[80vh] flex items-center bg-cover bg-center" style="background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.85) 0%, rgba(245, 244, 240, 0.8) 50%, rgba(255, 255, 255, 0.75) 100%), url('/images/heroes/homepage-hero.jpg');">
    <div class="container">
      <div class="max-w-4xl">
        <p class="eyebrow text-carolina mb-4">UNC Gillings School of Global Public Health</p>
        <h1 class="font-display text-navy mb-6 leading-tight tracking-tight">
          Advancing health through <em class="text-carolina">economics</em>, <em class="text-carolina">policy</em>, and <em class="text-carolina">digital innovation</em>
        </h1>
        <p class="text-xl md:text-2xl text-charcoal mb-8 leading-relaxed max-w-3xl">
          Integrate Behavioral and Computational Science for Health Policy Research in the Digital Age
        </p>
        <div class="flex flex-wrap gap-4">
          <a href="/research" class="btn-primary">
            Explore Our Research
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
          <a href="/panels" class="btn-secondary">
            Join a Research Panel
          </a>
          <a href="/newsletter" class="btn-secondary">
            Subscribe to Newsletter
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Bar -->
  <section class="bg-navy py-10">
    <div class="container">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
        {stats.map((stat) => (
          <div>
            <div class="stat-number">{stat.number}</div>
            <div class="stat-label">{stat.label}</div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Research Areas -->
  <section class="py-16 md:py-20 bg-paper">
    <div class="container">
      <div class="mb-12">
        <p class="eyebrow mb-3">What We Study</p>
        <h2 class="text-3xl md:text-4xl">Research Areas</h2>
        <div class="accent-line mt-4"></div>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        {researchAreas.map((area) => (
          <a href={area.link} class="card group">
            <img src={area.icon} alt={area.title} class="w-16 h-16 rounded-lg object-cover mb-4" />
            <h3 class="text-lg font-semibold text-navy mb-3 group-hover:text-carolina transition-colors">
              {area.title}
            </h3>
            <p class="text-slate leading-relaxed text-base">
              {area.description}
            </p>
            <div class="mt-4 text-carolina font-medium text-sm flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
              Learn more
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
              </svg>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Latest News -->
  <section class="py-16 md:py-20 bg-paper">
    <div class="container">
      <div class="flex items-end justify-between mb-10">
        <div>
          <p class="eyebrow mb-3">Lab Updates</p>
          <h2 class="text-3xl md:text-4xl">Latest News</h2>
          <div class="accent-line mt-4"></div>
        </div>
        <a href="/news" class="hidden md:flex items-center gap-2 text-carolina font-medium hover:text-carolina-dark transition-colors">
          View all news
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>

      <div class="grid md:grid-cols-12 gap-8">
        <!-- Featured news item -->
        {newsItems[0] && (
          <div class="md:col-span-7">
            <article class="card card-featured h-full">
              <span class="eyebrow text-carolina mb-3 block">{formatDate(newsItems[0].data.date)}</span>
              <h3 class="text-xl md:text-2xl font-display text-navy mb-4">{newsItems[0].data.title}</h3>
              <p class="text-slate leading-relaxed mb-4 text-base">{newsItems[0].data.excerpt}</p>
              <a href={`/news/${newsItems[0].id}`} class="text-carolina font-medium text-sm flex items-center gap-2 hover:text-carolina-dark transition-colors">
                Read more
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                </svg>
              </a>
            </article>
          </div>
        )}

        <!-- Secondary news items -->
        <div class="md:col-span-5 flex flex-col gap-6">
          {newsItems.slice(1).map((item) => (
            <article class="card">
              <span class="text-xs text-slate uppercase tracking-wide">{formatDate(item.data.date)}</span>
              <h4 class="text-lg font-semibold text-navy mt-2 mb-2">{item.data.title}</h4>
              <p class="text-sm text-slate line-clamp-2">{item.data.excerpt}</p>
            </article>
          ))}
        </div>
      </div>

      <a href="/news" class="md:hidden mt-8 text-carolina font-medium flex items-center gap-2">
        View all news
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </section>

  <!-- Team Preview -->
  <section class="py-16 md:py-20 bg-cream">
    <div class="container">
      <div class="text-center mb-10">
        <p class="eyebrow mb-3">Our People</p>
        <h2 class="text-3xl md:text-4xl mb-2">Meet the Team</h2>
        <div class="accent-line mx-auto mt-4"></div>
      </div>

      <div class="flex flex-wrap justify-center gap-10 mb-10">
        {sortedTeam.map((member) => (
          <a href={`/team/${member.id}`} class="text-center group cursor-pointer">
            {member.data.image ? (
              <img src={member.data.image} alt={member.data.name} class="w-28 h-28 rounded-full object-cover mb-3 border-3 border-white shadow-md group-hover:scale-105 transition-transform" />
            ) : (
              <div class="w-28 h-28 rounded-full bg-gradient-to-br from-carolina-light to-carolina flex items-center justify-center text-white text-2xl font-display mb-3 border-3 border-white shadow-md group-hover:scale-105 transition-transform">
                {member.data.name.split(' ').map(n => n[0]).join('')}
              </div>
            )}
            <div class="font-semibold text-navy text-base">{member.data.name}</div>
            <div class="text-sm text-slate">{member.data.role}</div>
          </a>
        ))}
      </div>

      <div class="text-center">
        <a href="/team" class="btn-secondary">
          View Full Team
        </a>
      </div>
    </div>
  </section>

  <!-- Partners Section -->
  <section class="py-16 md:py-20 bg-paper">
    <div class="container">
      <div class="text-center mb-10">
        <p class="eyebrow mb-3">Collaborations</p>
        <h2 class="text-3xl md:text-4xl mb-2">Our Partners</h2>
        <div class="accent-line mx-auto mt-4"></div>
      </div>

      <div class="flex flex-wrap justify-center items-center gap-6 md:gap-8">
        {[
          { name: "CollectiveGood", logo: "/images/partners/collectivegood.svg", url: "https://collectivegood.io" },
          { name: "CFK Africa", logo: "/images/partners/cfk-africa.svg", url: "https://cfkafrica.org" },
          { name: "NC DHIT", logo: "/images/partners/nc-dhit.svg", url: "https://ncdhit.org" },
          { name: "Humana Foundation", logo: "/images/partners/humana-foundation.svg", url: "https://www.humanafoundation.org" },
          { name: "Cone Health", logo: "/images/partners/cone-health.svg", url: "https://www.conehealth.com" },
          { name: "El Centro Hispano", logo: "/images/partners/el-centro-hispano.svg", url: "https://elcentronc.org" },
          { name: "AI@UNC", logo: "/images/partners/ai-unc.svg", url: "https://ai.unc.edu" },
          { name: "Fred Hutchinson Cancer Center", logo: "/images/partners/fred-hutch.svg", url: "https://www.fredhutch.org" }
        ].map((partner) => (
          <a href={partner.url} target="_blank" rel="noopener noreferrer" class="group transition-all hover:scale-105">
            <img src={partner.logo} alt={partner.name} class="h-14 w-auto opacity-70 group-hover:opacity-100 transition-opacity" />
          </a>
        ))}
      </div>

      <div class="text-center mt-8">
        <a href="/partners" class="text-carolina font-medium text-sm flex items-center justify-center gap-2 hover:text-carolina-dark transition-colors">
          View all partnerships
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Newsletter CTA -->
  <section class="py-16 md:py-20 bg-navy text-white">
    <div class="container">
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-2xl md:text-3xl font-display text-white mb-4">
          Stay Updated with DHEPLab Insights
        </h2>
        <p class="text-white/80 mb-6 text-lg">
          Weekly perspectives on digital health, clinical AI, and health economics research. Join researchers and practitioners shaping the future of healthcare.
        </p>
        <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
          <input
            type="email"
            placeholder="your@email.com"
            class="flex-1 px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder:text-white/50 focus:outline-none focus:border-carolina"
          />
          <button type="submit" class="btn-primary bg-carolina hover:bg-carolina-light">
            Subscribe
          </button>
        </form>
        <p class="text-xs text-white/50 mt-4">
          We respect your privacy. Unsubscribe at any time.
        </p>
      </div>
    </div>
  </section>

</BaseLayout>
